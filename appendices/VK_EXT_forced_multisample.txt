// Copyright 2021 The Khronos Group Inc.
//
// SPDX-License-Identifier: CC-BY-4.0

include::{generated}/meta/{refprefix}VK_EXT_forced_multisample.txt[]

=== Other Extension Metadata

*Last Modified Date*::
    2021-12-16
*IP Status*::
    No known IP claims.
*Contributors*::
  - Jonathan Weinstein, VMware

=== Description

This extension allows rendering to single-sample color attachment(s) while most
operations, most important being rasterization and the fragment shader's builtin
ename:Input ename:SampleMask, are based on a slink:VkPipelineMultisampleStateCreateInfo::pname:rasterizationSamples
value greater than one. If any sample in the rasterizer pattern for a pixel is
covered, the pixel is a candidate for shading. This enables more pixels along the edges
of primitives to be shaded, and the builtin input ename:SampleMask can be used as
way to determine how covered a pixel is. A use case for this is anti-aliased path rendering.

This "forced-multisample" mode only applies to pipelines that have
no depth/stencil attachment, have at least one color attachment with a
sample count of one, a pname:rasterizationSamples value greater than one
that is also enabled in slink:VkPhysicalDeviceForcedMultisampleFeaturesEXT::pname:forcedMultisampleCounts,
and no sname:VkPipelineCoverageReductionStateCreateInfoNV chained to
sname:VkPipelineMultisampleStateCreateInfo.

include::{generated}/interfaces/VK_EXT_forced_multisample.txt[]

=== Issues

1) How does this extension interact with `apiext:VK_NV_framebuffer_mixed_samples`
or `apiext:VK_AMD_mixed_attachment_samples`?

*PROPOSED*: Whenever forced-multisample applies to a pipeline, it's
behavior is used over those extensions. Note that forced-multisample
only applies when the color count is one and there is no depth/stencil
attachment. In this configuration, the any-to-one reduction mode of forced-multisample
is compatible with the merge reduction mode of `apiext:VK_NV_framebuffer_mixed_samples`,
with the extra guarantee that the subset is all of the rasterizer samples.
Also for such configurations, the truncation reduction mode of
`apiext:VK_AMD_mixed_attachment_samples` seems undesirable in comparison.
When forced-multisample mode does not apply to a pipeline, such us for pipelines
with a depth attachment, `apiext:VK_AMD_mixed_attachment_samples` or
`apiext:VK_NV_framebuffer_mixed_samples` apply instead. If for some reason an
application wants the truncation reduction mode with one color sample and no
depth attachment, they could use `apiext:VK_NV_coverage_reduction_mode`, as the
presence of a `sname:VkPipelineCoverageReductionStateCreateInfoNV` also makes
forced-multisample not apply to a pipeline.

=== Version History

 * Revision 1, 2021-12-16 (Jonathan Weinstein)
   - Initial version
