// Copyright 2023-2026 The Khronos Group Inc.
//
// SPDX-License-Identifier: CC-BY-4.0

// Common Valid Usage
// Common to VkImageMemoryBarrier* and VkHostImageLayoutTransitionInfo structs
// This relies on the following additional attributes set by the command which
// includes this file:
//
//  - {imagelayoutnotignored}, a text that specifies when the image layout is not ignored.

  * [[VUID-{refpage}-subresourceRange-01486]]
    pname:subresourceRange.baseMipLevel must: be less than the
    pname:mipLevels specified in slink:VkImageCreateInfo when pname:image
    was created
  * [[VUID-{refpage}-subresourceRange-01724]]
    If pname:subresourceRange.levelCount is not
    ename:VK_REMAINING_MIP_LEVELS, [eq]#pname:subresourceRange.baseMipLevel
    {plus} pname:subresourceRange.levelCount# must: be less than or equal to
    the pname:mipLevels specified in slink:VkImageCreateInfo when
    pname:image was created
  * [[VUID-{refpage}-subresourceRange-01488]]
ifdef::VK_KHR_maintenance9[]
    If pname:image is not a 3D image or was created without
    ename:VK_IMAGE_CREATE_2D_ARRAY_COMPATIBLE_BIT set, or the
    <<features-maintenance9, pname:maintenance9>> feature is not enabled,
endif::VK_KHR_maintenance9[]
    pname:subresourceRange.baseArrayLayer must: be less than the
    pname:arrayLayers specified in slink:VkImageCreateInfo when pname:image
    was created
ifdef::VK_KHR_maintenance9[]
  * [[VUID-{refpage}-maintenance9-10798]]
    If the <<features-maintenance9, pname:maintenance9>> feature is enabled
    and pname:image is a 3D image created with
    ename:VK_IMAGE_CREATE_2D_ARRAY_COMPATIBLE_BIT set,
    pname:subresourceRange.baseArrayLayer must: be less than the depth
    computed from pname:baseMipLevel and pname:extent.depth specified in
    slink:VkImageCreateInfo when pname:image was created, according to the
    formula defined in <<resources-image-mip-level-sizing,Image Mip Level
    Sizing>>
  * [[VUID-{refpage}-maintenance9-10799]]
    If the <<features-maintenance9, pname:maintenance9>> feature is enabled
    and pname:image is a 3D image created with
    ename:VK_IMAGE_CREATE_2D_ARRAY_COMPATIBLE_BIT set and either
    pname:subresourceRange.baseArrayLayer is not equal to 0 or
    pname:subresourceRange.layerCount is not equal to
    ename:VK_REMAINING_ARRAY_LAYERS, pname:subresourceRange.levelCount must:
    be 1
endif::VK_KHR_maintenance9[]
  * [[VUID-{refpage}-subresourceRange-01725]]
    If
ifdef::VK_KHR_maintenance9[]
    pname:image is not a 3D image or was created without
    ename:VK_IMAGE_CREATE_2D_ARRAY_COMPATIBLE_BIT set, or the
    <<features-maintenance9, pname:maintenance9>> feature is not enabled,
    and
endif::VK_KHR_maintenance9[]
    pname:subresourceRange.layerCount is not
    ename:VK_REMAINING_ARRAY_LAYERS,
    [eq]#pname:subresourceRange.baseArrayLayer {plus}
    pname:subresourceRange.layerCount# must: be less than or equal to the
    pname:arrayLayers specified in slink:VkImageCreateInfo when pname:image
    was created
ifdef::VK_KHR_maintenance9[]
  * [[VUID-{refpage}-maintenance9-10800]]
    If the <<features-maintenance9, pname:maintenance9>> feature is enabled,
    pname:subresourceRange.layerCount is not
    ename:VK_REMAINING_ARRAY_LAYERS, and pname:image is a 3D image created
    with ename:VK_IMAGE_CREATE_2D_ARRAY_COMPATIBLE_BIT set,
    [eq]#pname:subresourceRange.baseArrayLayer {plus}
    pname:subresourceRange.layerCount# must: be less than or equal to the
    depth computed from pname:baseMipLevel and pname:extent.depth specified
    in slink:VkImageCreateInfo when pname:image was created, according to
    the formula defined in <<resources-image-mip-level-sizing,Image Mip
    Level Sizing>>
endif::VK_KHR_maintenance9[]
  * [[VUID-{refpage}-image-01932]]
    If pname:image is non-sparse then the image
ifdef::VK_BASE_VERSION_1_1,VK_KHR_sampler_ycbcr_conversion[]
    or each specified _disjoint_ plane
endif::VK_BASE_VERSION_1_1,VK_KHR_sampler_ycbcr_conversion[]
    must: be bound completely and contiguously to a single
    sname:VkDeviceMemory object
  * [[VUID-{refpage}-image-09241]]
    If pname:image has a color format
ifdef::VK_BASE_VERSION_1_1,VK_KHR_sampler_ycbcr_conversion[]
    that is single-plane,
endif::VK_BASE_VERSION_1_1,VK_KHR_sampler_ycbcr_conversion[]
    then the pname:aspectMask member of pname:subresourceRange must: be
    ename:VK_IMAGE_ASPECT_COLOR_BIT
ifdef::VK_BASE_VERSION_1_1,VK_KHR_sampler_ycbcr_conversion[]
  * [[VUID-{refpage}-image-09242]]
    If pname:image has a color format and is not _disjoint_, then the
    pname:aspectMask member of pname:subresourceRange must: be
    ename:VK_IMAGE_ASPECT_COLOR_BIT
  * [[VUID-{refpage}-image-01672]]
    If pname:image has a <<formats-multiplanar, multi-planar format>> and
    the image is _disjoint_, then the pname:aspectMask member of
    pname:subresourceRange must: include at least one
    <<formats-multiplanar-image-aspect,multi-planar aspect mask>> bit or
    ename:VK_IMAGE_ASPECT_COLOR_BIT
endif::VK_BASE_VERSION_1_1,VK_KHR_sampler_ycbcr_conversion[]
  * [[VUID-{refpage}-image-03320]]
    If pname:image has a depth/stencil format with both depth and stencil
ifdef::VK_GRAPHICS_VERSION_1_2,VK_KHR_separate_depth_stencil_layouts[]
    and the <<features-separateDepthStencilLayouts,
    pname:separateDepthStencilLayouts>> feature is not enabled,
endif::VK_GRAPHICS_VERSION_1_2,VK_KHR_separate_depth_stencil_layouts[]
    then the pname:aspectMask member of pname:subresourceRange must: include
    both ename:VK_IMAGE_ASPECT_DEPTH_BIT and
    ename:VK_IMAGE_ASPECT_STENCIL_BIT
ifdef::VK_GRAPHICS_VERSION_1_2,VK_KHR_separate_depth_stencil_layouts[]
  * [[VUID-{refpage}-image-03319]]
    If pname:image has a depth/stencil format with both depth and stencil
    and the <<features-separateDepthStencilLayouts,
    pname:separateDepthStencilLayouts>> feature is enabled, then the
    pname:aspectMask member of pname:subresourceRange must: include either
    or both ename:VK_IMAGE_ASPECT_DEPTH_BIT and
    ename:VK_IMAGE_ASPECT_STENCIL_BIT
  * [[VUID-{refpage}-image-10749]]
    If pname:image has a depth-only format then the pname:aspectMask member
    of pname:subresourceRange must: be ename:VK_IMAGE_ASPECT_DEPTH_BIT
  * [[VUID-{refpage}-image-10750]]
    If pname:image has a stencil-only format then the pname:aspectMask
    member of pname:subresourceRange must: be
    ename:VK_IMAGE_ASPECT_STENCIL_BIT
  * [[VUID-{refpage}-aspectMask-08702]]
    If the pname:aspectMask member of pname:subresourceRange includes
    ename:VK_IMAGE_ASPECT_DEPTH_BIT, pname:oldLayout and pname:newLayout
    must: not be one of ename:VK_IMAGE_LAYOUT_STENCIL_ATTACHMENT_OPTIMAL or
    ename:VK_IMAGE_LAYOUT_STENCIL_READ_ONLY_OPTIMAL
  * [[VUID-{refpage}-aspectMask-08703]]
    If the pname:aspectMask member of pname:subresourceRange includes
    ename:VK_IMAGE_ASPECT_STENCIL_BIT, pname:oldLayout and pname:newLayout
    must: not be one of ename:VK_IMAGE_LAYOUT_DEPTH_ATTACHMENT_OPTIMAL or
    ename:VK_IMAGE_LAYOUT_DEPTH_READ_ONLY_OPTIMAL
endif::VK_GRAPHICS_VERSION_1_2,VK_KHR_separate_depth_stencil_layouts[]
  * [[VUID-{refpage}-subresourceRange-09601]]
    pname:subresourceRange.aspectMask must: be valid for the pname:format
    the pname:image was created with

  * [[VUID-{refpage}-oldLayout-01208]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL then pname:image must:
    have been created with the ename:VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT
    usage flag set
  * [[VUID-{refpage}-oldLayout-01209]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_DEPTH_STENCIL_ATTACHMENT_OPTIMAL then pname:image
    must: have been created with the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flag set
  * [[VUID-{refpage}-oldLayout-01210]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_DEPTH_STENCIL_READ_ONLY_OPTIMAL then pname:image
    must: have been created with the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flag set
  * [[VUID-{refpage}-oldLayout-01211]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL then pname:image must:
    have been created with the ename:VK_IMAGE_USAGE_SAMPLED_BIT or
    ename:VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT usage flag set
  * [[VUID-{refpage}-oldLayout-01212]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL then pname:image must: have
    been created with the ename:VK_IMAGE_USAGE_TRANSFER_SRC_BIT usage flag
    set
  * [[VUID-{refpage}-oldLayout-01213]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL then pname:image must: have
    been created with the ename:VK_IMAGE_USAGE_TRANSFER_DST_BIT usage flag
    set
ifdef::VK_EXT_zero_initialize_device_memory[]
  * [[VUID-{refpage}-oldLayout-10767]]
    If the <<features-zeroInitializeDeviceMemory,
    zeroInitializeDeviceMemory>> feature is not enabled, pname:oldLayout
    must: not be ename:VK_IMAGE_LAYOUT_ZERO_INITIALIZED_EXT
  * [[VUID-{refpage}-oldLayout-10768]]
    If pname:oldLayout is ename:VK_IMAGE_LAYOUT_ZERO_INITIALIZED_EXT, then
    all subresources must: be included in the barrier
endif::VK_EXT_zero_initialize_device_memory[]
ifdef::VK_GRAPHICS_VERSION_1_1,VK_KHR_maintenance2[]
  * [[VUID-{refpage}-oldLayout-01658]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_DEPTH_READ_ONLY_STENCIL_ATTACHMENT_OPTIMAL then
    pname:image must: have been created with the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flag set
  * [[VUID-{refpage}-oldLayout-01659]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_DEPTH_ATTACHMENT_STENCIL_READ_ONLY_OPTIMAL then
    pname:image must: have been created with the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flag set
endif::VK_GRAPHICS_VERSION_1_1,VK_KHR_maintenance2[]
ifdef::VK_GRAPHICS_VERSION_1_2,VK_EXT_separate_depth_stencil_layouts[]
  * [[VUID-{refpage}-srcQueueFamilyIndex-04065]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_DEPTH_READ_ONLY_OPTIMAL then pname:image must:
    have been created with at least one of the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT,
    ename:VK_IMAGE_USAGE_SAMPLED_BIT, or
    ename:VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT usage flags set
  * [[VUID-{refpage}-srcQueueFamilyIndex-04066]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_DEPTH_ATTACHMENT_OPTIMAL then pname:image must:
    have been created with the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flag set
  * [[VUID-{refpage}-srcQueueFamilyIndex-04067]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_STENCIL_READ_ONLY_OPTIMAL then pname:image must:
    have been created with at least one of the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT,
    ename:VK_IMAGE_USAGE_SAMPLED_BIT, or
    ename:VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT usage flags set
  * [[VUID-{refpage}-srcQueueFamilyIndex-04068]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_STENCIL_ATTACHMENT_OPTIMAL then pname:image must:
    have been created with the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flag set
endif::VK_GRAPHICS_VERSION_1_2,VK_EXT_separate_depth_stencil_layouts[]
ifdef::VK_BASE_VERSION_1_3,VK_KHR_synchronization2[]
  * [[VUID-{refpage}-synchronization2-07793]]
    If the <<features-synchronization2, pname:synchronization2>> feature is
    not enabled, pname:oldLayout must: not be
    ename:VK_IMAGE_LAYOUT_ATTACHMENT_OPTIMAL_KHR or
    ename:VK_IMAGE_LAYOUT_READ_ONLY_OPTIMAL_KHR
  * [[VUID-{refpage}-synchronization2-07794]]
    If the <<features-synchronization2, pname:synchronization2>> feature is
    not enabled, pname:newLayout must: not be
    ename:VK_IMAGE_LAYOUT_ATTACHMENT_OPTIMAL_KHR or
    ename:VK_IMAGE_LAYOUT_READ_ONLY_OPTIMAL_KHR
  * [[VUID-{refpage}-srcQueueFamilyIndex-03938]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_ATTACHMENT_OPTIMAL, pname:image must: have been
    created with the ename:VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT or
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flag set
  * [[VUID-{refpage}-srcQueueFamilyIndex-03939]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_READ_ONLY_OPTIMAL, pname:image must: have been
    created with at least one of the
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT,
    ename:VK_IMAGE_USAGE_SAMPLED_BIT, or
    ename:VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT usage flags set
endif::VK_BASE_VERSION_1_3,VK_KHR_synchronization2[]
ifdef::VK_KHR_fragment_shading_rate,VK_NV_shading_rate_image[]
  * [[VUID-{refpage}-oldLayout-02088]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_FRAGMENT_SHADING_RATE_ATTACHMENT_OPTIMAL_KHR then
    pname:image must: have been created with the
    ename:VK_IMAGE_USAGE_FRAGMENT_SHADING_RATE_ATTACHMENT_BIT_KHR usage flag
    set
endif::VK_KHR_fragment_shading_rate,VK_NV_shading_rate_image[]
ifdef::VK_KHR_video_decode_queue[]
  * [[VUID-{refpage}-srcQueueFamilyIndex-07120]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_VIDEO_DECODE_SRC_KHR then pname:image must: have
    been created with the ename:VK_IMAGE_USAGE_VIDEO_DECODE_SRC_BIT_KHR
    usage flag set
  * [[VUID-{refpage}-srcQueueFamilyIndex-07121]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_VIDEO_DECODE_DST_KHR then pname:image must: have
    been created with the ename:VK_IMAGE_USAGE_VIDEO_DECODE_DST_BIT_KHR
    usage flag set
  * [[VUID-{refpage}-srcQueueFamilyIndex-07122]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_VIDEO_DECODE_DPB_KHR then pname:image must: have
    been created with the ename:VK_IMAGE_USAGE_VIDEO_DECODE_DPB_BIT_KHR
    usage flag set
endif::VK_KHR_video_decode_queue[]
ifdef::VK_KHR_video_encode_queue[]
  * [[VUID-{refpage}-srcQueueFamilyIndex-07123]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_VIDEO_ENCODE_SRC_KHR then pname:image must: have
    been created with the ename:VK_IMAGE_USAGE_VIDEO_ENCODE_SRC_BIT_KHR
    usage flag set
  * [[VUID-{refpage}-srcQueueFamilyIndex-07124]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_VIDEO_ENCODE_DST_KHR then pname:image must: have
    been created with the ename:VK_IMAGE_USAGE_VIDEO_ENCODE_DST_BIT_KHR
    usage flag set
  * [[VUID-{refpage}-srcQueueFamilyIndex-07125]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_VIDEO_ENCODE_DPB_KHR then pname:image must: have
    been created with the ename:VK_IMAGE_USAGE_VIDEO_ENCODE_DPB_BIT_KHR
    usage flag set
endif::VK_KHR_video_encode_queue[]
ifdef::VK_KHR_video_encode_quantization_map[]
  * [[VUID-{refpage}-srcQueueFamilyIndex-10287]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_VIDEO_ENCODE_QUANTIZATION_MAP_KHR then pname:image
    must: have been created with the
    ename:VK_IMAGE_USAGE_VIDEO_ENCODE_QUANTIZATION_DELTA_MAP_BIT_KHR or
    ename:VK_IMAGE_USAGE_VIDEO_ENCODE_EMPHASIS_MAP_BIT_KHR usage flags set
endif::VK_KHR_video_encode_quantization_map[]
ifdef::VK_EXT_attachment_feedback_loop_layout[]
  * [[VUID-{refpage}-srcQueueFamilyIndex-07006]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_ATTACHMENT_FEEDBACK_LOOP_OPTIMAL_EXT then
    pname:image must: have been created with either the
    ename:VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT or
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flags set, and
    the ename:VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT or
    ename:VK_IMAGE_USAGE_SAMPLED_BIT usage flags set, and the
    ename:VK_IMAGE_USAGE_ATTACHMENT_FEEDBACK_LOOP_BIT_EXT usage flag set
  * [[VUID-{refpage}-attachmentFeedbackLoopLayout-07313]]
    If the <<features-attachmentFeedbackLoopLayout,
    pname:attachmentFeedbackLoopLayout>> feature is not enabled,
    pname:newLayout must: not be
    ename:VK_IMAGE_LAYOUT_ATTACHMENT_FEEDBACK_LOOP_OPTIMAL_EXT
endif::VK_EXT_attachment_feedback_loop_layout[]
ifdef::VK_GRAPHICS_VERSION_1_4,VK_KHR_dynamic_rendering_local_read[]
  * [[VUID-{refpage}-srcQueueFamilyIndex-09550]]
    If {imagelayoutnotignored} pname:oldLayout or pname:newLayout is
    ename:VK_IMAGE_LAYOUT_RENDERING_LOCAL_READ then pname:image must: have
    been created with either the ename:VK_IMAGE_USAGE_STORAGE_BIT usage flag
    set, or with both the ename:VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT usage
    flag and either of the ename:VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT or
    ename:VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT usage flags set
  * [[VUID-{refpage}-dynamicRenderingLocalRead-09551]]
    If the <<features-dynamicRenderingLocalRead,
    pname:dynamicRenderingLocalRead>> feature is not enabled,
    pname:oldLayout must: not be ename:VK_IMAGE_LAYOUT_RENDERING_LOCAL_READ
  * [[VUID-{refpage}-dynamicRenderingLocalRead-09552]]
    If the <<features-dynamicRenderingLocalRead,
    pname:dynamicRenderingLocalRead>> feature is not enabled,
    pname:newLayout must: not be ename:VK_IMAGE_LAYOUT_RENDERING_LOCAL_READ
endif::VK_GRAPHICS_VERSION_1_4,VK_KHR_dynamic_rendering_local_read[]

// Common Valid Usage
